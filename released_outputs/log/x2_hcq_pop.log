-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/log\x2_hcq_pop.log
  log type:  text
 opened on:  15 Jul 2020, 09:46:00

. 
. 
. 
. 
. /* SET Index date ===========================================================
> */
. global indexdate                        = "01/03/2020"

. 
. 
. 
. 
. 
. // variable i have are
. // hcq_count
. // dmards_primary_care_count
. // rheumatoid
. // sle
. 
. 
. 
. 
. /* CONVERT STRINGS TO DATE===================================================
> =*/
. /* Comorb dates are given with month/year only, so adding day 15 to enable
>    them to be processed as dates                                             
>                                              */
. 
. foreach var of varlist   rheumatoid                                          
>            ///
>                                                  sle                         
>                                    ///
>          {
  2.                                                         
.                 capture confirm string variable `var'
  3.                 if _rc!=0 {
  4.                         assert `var'==.
  5.                         rename `var' `var'_date
  6.                 }
  7.         
.                 else {
  8.                                 replace `var' = `var' + "-15"
  9.                                 rename `var' `var'_dstr
 10.                                 replace `var'_dstr = " " if `var'_dstr == 
> "-15"
 11.                                 gen `var'_date = date(`var'_dstr, "YMD") 
 12.                                 order `var'_date, after(`var'_dstr)
 13.                                 drop `var'_dstr
 14.                 }
 15.         
.         format `var'_date %td
 16. }
variable rheumatoid was str7 now str10
(17,209,056 real changes made)
(17,040,421 real changes made)
(17,040,421 missing values generated)
variable sle was str7 now str10
(17,209,056 real changes made)
(17,180,766 real changes made)
(17,180,766 missing values generated)

. 
. 
. /* CREATE BINARY VARIABLES===================================================
> =*/
. *  Make indicator variables for all conditions where relevant 
. 
. foreach var of varlist   rheumatoid_date                                     
>    ///
>                                                  sle_date                    
>                                    ///
>          {
  2.         /* date ranges are applied in python, so presence of date indicate
> s presence of 
>           disease in the correct time frame */ 
.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         
. }

. 
. 
. 
. /* EXPOSURE INFORMATION ====================================================*
> /
. gen hcq = 1 if hcq_count != . & hcq_count >= 2
(17,164,500 missing values generated)

. recode hcq .=0
(hcq: 17164500 changes made)

. 
. 
. /* OTHER DRUGS =============================================================*
> /
. gen dmard_pc = 1 if dmards_primary_care_count != . & dmards_primary_care_coun
> t >= 2
(17,067,604 missing values generated)

. recode dmard_pc .=0
(dmard_pc: 17067604 changes made)

. 
. 
. 
. 
. 
. /* DEMOGRAPHICS */ 
. 
. * Sex
. gen male = 1 if sex == "M"
(8,614,464 missing values generated)

. replace male = 0 if sex == "F"
(8,614,464 real changes made)

. 
. /*  IMD  */
. * Group into 5 groups
. rename imd imd_o

. egen imd = cut(imd_o), group(5) icodes

. 
. * add one to create groups 1 - 5 
. replace imd = imd + 1
(17,209,056 real changes made)

. 
. * - 1 is missing, should be excluded from population 
. replace imd = .u if imd_o == -1
(0 real changes made)

. drop imd_o

. 
. * Reverse the order (so high is more deprived)
. recode imd 5 = 1 4 = 2 3 = 3 2 = 4 1 = 5 .u = .u
(imd: 13747518 changes made)

. 
. label define imd 1 "1 least deprived" 2 "2" 3 "3" 4 "4" 5 "5 most deprived" .
> u "Unknown"

. label values imd imd 

. 
. /*  Age variables  */ 
. 
. * Create categorised age
. recode age 18/39.9999 = 1 /// 
>            40/49.9999 = 2 ///
>                    50/59.9999 = 3 ///
>                60/69.9999 = 4 ///
>                    70/79.9999 = 5 ///
>                    80/max = 6, gen(agegroup) 
(17209056 differences between age and agegroup)

. 
. label define agegroup   1 "18-<40" ///
>                                                 2 "40-<50" ///
>                                                 3 "50-<60" ///
>                                                 4 "60-<70" ///
>                                                 5 "70-<80" ///
>                                                 6 "80+"

.                                                 
. label values agegroup agegroup

. 
. 
. 
. 
. 
. /* APPLY INCLUSION/EXCLUIONS=================================================
> =*/ 
. 
. noi di "DROP MISSING GENDER:"
DROP MISSING GENDER:

. drop if inlist(sex,"I", "U")
(0 observations deleted)

. 
. noi di "DROP AGE <18:"
DROP AGE <18:

. drop if age < 18 
(0 observations deleted)

. 
. noi di "DROP AGE >110:"
DROP AGE >110:

. drop if age > 110 & age != .
(0 observations deleted)

. 
. noi di "DROP AGE MISSING:"
DROP AGE MISSING:

. drop if age == . 
(0 observations deleted)

. 
. noi di "DROP IMD MISSING"
DROP IMD MISSING

. drop if imd == .u
(0 observations deleted)

. 
. 
. /* CHECK INCLUSION AND EXCLUSION CRITERIA====================================
> =*/ 
. 
. * DATA STRUCTURE: Confirm one row per patient 
. duplicates tag patient_id, generate(dup_check)

Duplicates in terms of patient_id

. assert dup_check == 0 

. drop dup_check

. 
. * INCLUSION 2: >=18 and <=110 at 1 March 2020 
. assert age < .

. assert age >= 18 

. assert age <= 110

.  
.  * EXCLUSION 3a: M or F gender at 1 March 2020 
. assert inlist(sex, "M", "F")

. 
. * EXCLUSION 3b:  MISSING IMD
. assert inlist(imd, 1, 2, 3, 4, 5)

. 
. 
. 
. 
. 
. 
. 
. 
. *get some stats 
. 
. *demographics
. tab1 male imd agegroup, m

-> tabulation of male  

       male |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  8,614,464       50.06       50.06
          1 |  8,594,592       49.94      100.00
------------+-----------------------------------
      Total | 17,209,056      100.00

-> tabulation of imd  

             imd |      Freq.     Percent        Cum.
-----------------+-----------------------------------
1 least deprived |  3,456,564       20.09       20.09
               2 |  3,446,938       20.03       40.12
               3 |  3,461,538       20.11       60.23
               4 |  3,424,743       19.90       80.13
 5 most deprived |  3,419,273       19.87      100.00
-----------------+-----------------------------------
           Total | 17,209,056      100.00

-> tabulation of agegroup  

  RECODE of |
        age |      Freq.     Percent        Cum.
------------+-----------------------------------
     18-<40 |  5,883,840       34.19       34.19
     40-<50 |  2,834,953       16.47       50.66
     50-<60 |  3,039,267       17.66       68.32
     60-<70 |  2,385,087       13.86       82.18
     70-<80 |  1,936,101       11.25       93.43
        80+ |  1,129,808        6.57      100.00
------------+-----------------------------------
      Total | 17,209,056      100.00

. 
. *PREVALENCE OVERALL
. tab1 hcq dmard_pc, m

-> tabulation of hcq  

        hcq |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 17,164,500       99.74       99.74
          1 |     44,556        0.26      100.00
------------+-----------------------------------
      Total | 17,209,056      100.00

-> tabulation of dmard_pc  

   dmard_pc |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 17,067,604       99.18       99.18
          1 |    141,452        0.82      100.00
------------+-----------------------------------
      Total | 17,209,056      100.00

. *hcq prevalence in patient groups
. tab rheumatoid hcq,m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
rheumatoid |         0          1 |     Total
-----------+----------------------+----------
         0 |17,019,964     20,457 |17,040,421 
           |     99.88       0.12 |    100.00 
-----------+----------------------+----------
         1 |   144,536     24,099 |   168,635 
           |     85.71      14.29 |    100.00 
-----------+----------------------+----------
     Total |17,164,500     44,556 |17,209,056 
           |     99.74       0.26 |    100.00 

. tab sle hcq, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
       sle |         0          1 |     Total
-----------+----------------------+----------
         0 |17,143,673     37,093 |17,180,766 
           |     99.78       0.22 |    100.00 
-----------+----------------------+----------
         1 |    20,827      7,463 |    28,290 
           |     73.62      26.38 |    100.00 
-----------+----------------------+----------
     Total |17,164,500     44,556 |17,209,056 
           |     99.74       0.26 |    100.00 

. tab male hcq, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
      male |         0          1 |     Total
-----------+----------------------+----------
         0 | 8,579,946     34,518 | 8,614,464 
           |     99.60       0.40 |    100.00 
-----------+----------------------+----------
         1 | 8,584,554     10,038 | 8,594,592 
           |     99.88       0.12 |    100.00 
-----------+----------------------+----------
     Total |17,164,500     44,556 |17,209,056 
           |     99.74       0.26 |    100.00 

. tab imd hcq, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                 |          hcq
             imd |         0          1 |     Total
-----------------+----------------------+----------
1 least deprived | 3,447,239      9,325 | 3,456,564 
                 |     99.73       0.27 |    100.00 
-----------------+----------------------+----------
               2 | 3,437,816      9,122 | 3,446,938 
                 |     99.74       0.26 |    100.00 
-----------------+----------------------+----------
               3 | 3,452,259      9,279 | 3,461,538 
                 |     99.73       0.27 |    100.00 
-----------------+----------------------+----------
               4 | 3,416,094      8,649 | 3,424,743 
                 |     99.75       0.25 |    100.00 
-----------------+----------------------+----------
 5 most deprived | 3,411,092      8,181 | 3,419,273 
                 |     99.76       0.24 |    100.00 
-----------------+----------------------+----------
           Total |17,164,500     44,556 |17,209,056 
                 |     99.74       0.26 |    100.00 

. tab agegroup hcq, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

 RECODE of |          hcq
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 | 5,880,241      3,599 | 5,883,840 
           |     99.94       0.06 |    100.00 
-----------+----------------------+----------
    40-<50 | 2,829,247      5,706 | 2,834,953 
           |     99.80       0.20 |    100.00 
-----------+----------------------+----------
    50-<60 | 3,029,201     10,066 | 3,039,267 
           |     99.67       0.33 |    100.00 
-----------+----------------------+----------
    60-<70 | 2,373,591     11,496 | 2,385,087 
           |     99.52       0.48 |    100.00 
-----------+----------------------+----------
    70-<80 | 1,926,288      9,813 | 1,936,101 
           |     99.49       0.51 |    100.00 
-----------+----------------------+----------
       80+ | 1,125,932      3,876 | 1,129,808 
           |     99.66       0.34 |    100.00 
-----------+----------------------+----------
     Total |17,164,500     44,556 |17,209,056 
           |     99.74       0.26 |    100.00 

. *dmard prevalence in patient groups
. tab rheumatoid dmard_pc,m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
rheumatoid |         0          1 |     Total
-----------+----------------------+----------
         0 |16,967,669     72,752 |17,040,421 
           |     99.57       0.43 |    100.00 
-----------+----------------------+----------
         1 |    99,935     68,700 |   168,635 
           |     59.26      40.74 |    100.00 
-----------+----------------------+----------
     Total |17,067,604    141,452 |17,209,056 
           |     99.18       0.82 |    100.00 

. tab sle dmard_pc, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
       sle |         0          1 |     Total
-----------+----------------------+----------
         0 |17,042,911    137,855 |17,180,766 
           |     99.20       0.80 |    100.00 
-----------+----------------------+----------
         1 |    24,693      3,597 |    28,290 
           |     87.29      12.71 |    100.00 
-----------+----------------------+----------
     Total |17,067,604    141,452 |17,209,056 
           |     99.18       0.82 |    100.00 

. tab male dmard_pc, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
      male |         0          1 |     Total
-----------+----------------------+----------
         0 | 8,528,205     86,259 | 8,614,464 
           |     99.00       1.00 |    100.00 
-----------+----------------------+----------
         1 | 8,539,399     55,193 | 8,594,592 
           |     99.36       0.64 |    100.00 
-----------+----------------------+----------
     Total |17,067,604    141,452 |17,209,056 
           |     99.18       0.82 |    100.00 

. tab imd dmard_pc, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                 |       dmard_pc
             imd |         0          1 |     Total
-----------------+----------------------+----------
1 least deprived | 3,425,511     31,053 | 3,456,564 
                 |     99.10       0.90 |    100.00 
-----------------+----------------------+----------
               2 | 3,416,836     30,102 | 3,446,938 
                 |     99.13       0.87 |    100.00 
-----------------+----------------------+----------
               3 | 3,431,881     29,657 | 3,461,538 
                 |     99.14       0.86 |    100.00 
-----------------+----------------------+----------
               4 | 3,397,859     26,884 | 3,424,743 
                 |     99.22       0.78 |    100.00 
-----------------+----------------------+----------
 5 most deprived | 3,395,517     23,756 | 3,419,273 
                 |     99.31       0.69 |    100.00 
-----------------+----------------------+----------
           Total |17,067,604    141,452 |17,209,056 
                 |     99.18       0.82 |    100.00 

. tab agegroup dmard_pc, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

 RECODE of |       dmard_pc
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 | 5,869,402     14,438 | 5,883,840 
           |     99.75       0.25 |    100.00 
-----------+----------------------+----------
    40-<50 | 2,818,803     16,150 | 2,834,953 
           |     99.43       0.57 |    100.00 
-----------+----------------------+----------
    50-<60 | 3,010,321     28,946 | 3,039,267 
           |     99.05       0.95 |    100.00 
-----------+----------------------+----------
    60-<70 | 2,351,527     33,560 | 2,385,087 
           |     98.59       1.41 |    100.00 
-----------+----------------------+----------
    70-<80 | 1,903,037     33,064 | 1,936,101 
           |     98.29       1.71 |    100.00 
-----------+----------------------+----------
       80+ | 1,114,514     15,294 | 1,129,808 
           |     98.65       1.35 |    100.00 
-----------+----------------------+----------
     Total |17,067,604    141,452 |17,209,056 
           |     99.18       0.82 |    100.00 

. 
. 
. *PREVALENCE IN RA
. tab1 hcq dmard_pc if rheumatoid == 1, m

-> tabulation of hcq if rheumatoid == 1 

        hcq |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    144,536       85.71       85.71
          1 |     24,099       14.29      100.00
------------+-----------------------------------
      Total |    168,635      100.00

-> tabulation of dmard_pc if rheumatoid == 1 

   dmard_pc |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     99,935       59.26       59.26
          1 |     68,700       40.74      100.00
------------+-----------------------------------
      Total |    168,635      100.00

. *hcq prevalence in patient groups
. tab sle hcq if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
       sle |         0          1 |     Total
-----------+----------------------+----------
         0 |   142,942     23,040 |   165,982 
           |     86.12      13.88 |    100.00 
-----------+----------------------+----------
         1 |     1,594      1,059 |     2,653 
           |     60.08      39.92 |    100.00 
-----------+----------------------+----------
     Total |   144,536     24,099 |   168,635 
           |     85.71      14.29 |    100.00 

. tab male hcq if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
      male |         0          1 |     Total
-----------+----------------------+----------
         0 |    99,614     17,530 |   117,144 
           |     85.04      14.96 |    100.00 
-----------+----------------------+----------
         1 |    44,922      6,569 |    51,491 
           |     87.24      12.76 |    100.00 
-----------+----------------------+----------
     Total |   144,536     24,099 |   168,635 
           |     85.71      14.29 |    100.00 

. tab imd hcq if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                 |          hcq
             imd |         0          1 |     Total
-----------------+----------------------+----------
1 least deprived |    29,342      4,796 |    34,138 
                 |     85.95      14.05 |    100.00 
-----------------+----------------------+----------
               2 |    29,377      4,826 |    34,203 
                 |     85.89      14.11 |    100.00 
-----------------+----------------------+----------
               3 |    30,086      5,095 |    35,181 
                 |     85.52      14.48 |    100.00 
-----------------+----------------------+----------
               4 |    28,632      4,774 |    33,406 
                 |     85.71      14.29 |    100.00 
-----------------+----------------------+----------
 5 most deprived |    27,099      4,608 |    31,707 
                 |     85.47      14.53 |    100.00 
-----------------+----------------------+----------
           Total |   144,536     24,099 |   168,635 
                 |     85.71      14.29 |    100.00 

. tab agegroup hcq if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

 RECODE of |          hcq
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |     8,978      1,166 |    10,144 
           |     88.51      11.49 |    100.00 
-----------+----------------------+----------
    40-<50 |    12,872      2,354 |    15,226 
           |     84.54      15.46 |    100.00 
-----------+----------------------+----------
    50-<60 |    26,117      4,974 |    31,091 
           |     84.00      16.00 |    100.00 
-----------+----------------------+----------
    60-<70 |    33,605      6,678 |    40,283 
           |     83.42      16.58 |    100.00 
-----------+----------------------+----------
    70-<80 |    38,338      6,277 |    44,615 
           |     85.93      14.07 |    100.00 
-----------+----------------------+----------
       80+ |    24,626      2,650 |    27,276 
           |     90.28       9.72 |    100.00 
-----------+----------------------+----------
     Total |   144,536     24,099 |   168,635 
           |     85.71      14.29 |    100.00 

. *dmard prevalence in patient groups
. tab sle dmard_pc if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
       sle |         0          1 |     Total
-----------+----------------------+----------
         0 |    98,228     67,754 |   165,982 
           |     59.18      40.82 |    100.00 
-----------+----------------------+----------
         1 |     1,707        946 |     2,653 
           |     64.34      35.66 |    100.00 
-----------+----------------------+----------
     Total |    99,935     68,700 |   168,635 
           |     59.26      40.74 |    100.00 

. tab male dmard_pc if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
      male |         0          1 |     Total
-----------+----------------------+----------
         0 |    70,030     47,114 |   117,144 
           |     59.78      40.22 |    100.00 
-----------+----------------------+----------
         1 |    29,905     21,586 |    51,491 
           |     58.08      41.92 |    100.00 
-----------+----------------------+----------
     Total |    99,935     68,700 |   168,635 
           |     59.26      40.74 |    100.00 

. tab imd dmard_pc if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                 |       dmard_pc
             imd |         0          1 |     Total
-----------------+----------------------+----------
1 least deprived |    19,613     14,525 |    34,138 
                 |     57.45      42.55 |    100.00 
-----------------+----------------------+----------
               2 |    19,820     14,383 |    34,203 
                 |     57.95      42.05 |    100.00 
-----------------+----------------------+----------
               3 |    20,740     14,441 |    35,181 
                 |     58.95      41.05 |    100.00 
-----------------+----------------------+----------
               4 |    20,095     13,311 |    33,406 
                 |     60.15      39.85 |    100.00 
-----------------+----------------------+----------
 5 most deprived |    19,667     12,040 |    31,707 
                 |     62.03      37.97 |    100.00 
-----------------+----------------------+----------
           Total |    99,935     68,700 |   168,635 
                 |     59.26      40.74 |    100.00 

. tab agegroup dmard_pc if rheumatoid == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

 RECODE of |       dmard_pc
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |     7,656      2,488 |    10,144 
           |     75.47      24.53 |    100.00 
-----------+----------------------+----------
    40-<50 |     9,999      5,227 |    15,226 
           |     65.67      34.33 |    100.00 
-----------+----------------------+----------
    50-<60 |    18,529     12,562 |    31,091 
           |     59.60      40.40 |    100.00 
-----------+----------------------+----------
    60-<70 |    22,202     18,081 |    40,283 
           |     55.12      44.88 |    100.00 
-----------+----------------------+----------
    70-<80 |    24,402     20,213 |    44,615 
           |     54.69      45.31 |    100.00 
-----------+----------------------+----------
       80+ |    17,147     10,129 |    27,276 
           |     62.86      37.14 |    100.00 
-----------+----------------------+----------
     Total |    99,935     68,700 |   168,635 
           |     59.26      40.74 |    100.00 

. 
. *PREVALENCE IN SLE
. tab1 hcq dmard_pc if sle == 1, m

-> tabulation of hcq if sle == 1 

        hcq |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     20,827       73.62       73.62
          1 |      7,463       26.38      100.00
------------+-----------------------------------
      Total |     28,290      100.00

-> tabulation of dmard_pc if sle == 1 

   dmard_pc |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     24,693       87.29       87.29
          1 |      3,597       12.71      100.00
------------+-----------------------------------
      Total |     28,290      100.00

. *hcq prevalence in patient groups
. tab rheumatoid hcq if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
rheumatoid |         0          1 |     Total
-----------+----------------------+----------
         0 |    19,233      6,404 |    25,637 
           |     75.02      24.98 |    100.00 
-----------+----------------------+----------
         1 |     1,594      1,059 |     2,653 
           |     60.08      39.92 |    100.00 
-----------+----------------------+----------
     Total |    20,827      7,463 |    28,290 
           |     73.62      26.38 |    100.00 

. tab male hcq if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |          hcq
      male |         0          1 |     Total
-----------+----------------------+----------
         0 |    16,692      6,719 |    23,411 
           |     71.30      28.70 |    100.00 
-----------+----------------------+----------
         1 |     4,135        744 |     4,879 
           |     84.75      15.25 |    100.00 
-----------+----------------------+----------
     Total |    20,827      7,463 |    28,290 
           |     73.62      26.38 |    100.00 

. tab imd hcq if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                 |          hcq
             imd |         0          1 |     Total
-----------------+----------------------+----------
1 least deprived |     4,399      1,497 |     5,896 
                 |     74.61      25.39 |    100.00 
-----------------+----------------------+----------
               2 |     4,345      1,472 |     5,817 
                 |     74.69      25.31 |    100.00 
-----------------+----------------------+----------
               3 |     4,294      1,507 |     5,801 
                 |     74.02      25.98 |    100.00 
-----------------+----------------------+----------
               4 |     3,965      1,486 |     5,451 
                 |     72.74      27.26 |    100.00 
-----------------+----------------------+----------
 5 most deprived |     3,824      1,501 |     5,325 
                 |     71.81      28.19 |    100.00 
-----------------+----------------------+----------
           Total |    20,827      7,463 |    28,290 
                 |     73.62      26.38 |    100.00 

. tab agegroup hcq if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

 RECODE of |          hcq
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |     2,544      1,227 |     3,771 
           |     67.46      32.54 |    100.00 
-----------+----------------------+----------
    40-<50 |     3,107      1,406 |     4,513 
           |     68.85      31.15 |    100.00 
-----------+----------------------+----------
    50-<60 |     4,641      1,889 |     6,530 
           |     71.07      28.93 |    100.00 
-----------+----------------------+----------
    60-<70 |     4,491      1,564 |     6,055 
           |     74.17      25.83 |    100.00 
-----------+----------------------+----------
    70-<80 |     4,023      1,033 |     5,056 
           |     79.57      20.43 |    100.00 
-----------+----------------------+----------
       80+ |     2,021        344 |     2,365 
           |     85.45      14.55 |    100.00 
-----------+----------------------+----------
     Total |    20,827      7,463 |    28,290 
           |     73.62      26.38 |    100.00 

. *dmard prevalence in patient groups
. tab rheumatoid dmard_pc if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
rheumatoid |         0          1 |     Total
-----------+----------------------+----------
         0 |    22,986      2,651 |    25,637 
           |     89.66      10.34 |    100.00 
-----------+----------------------+----------
         1 |     1,707        946 |     2,653 
           |     64.34      35.66 |    100.00 
-----------+----------------------+----------
     Total |    24,693      3,597 |    28,290 
           |     87.29      12.71 |    100.00 

. tab male dmard_pc if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |       dmard_pc
      male |         0          1 |     Total
-----------+----------------------+----------
         0 |    20,256      3,155 |    23,411 
           |     86.52      13.48 |    100.00 
-----------+----------------------+----------
         1 |     4,437        442 |     4,879 
           |     90.94       9.06 |    100.00 
-----------+----------------------+----------
     Total |    24,693      3,597 |    28,290 
           |     87.29      12.71 |    100.00 

. tab imd dmard_pc if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

                 |       dmard_pc
             imd |         0          1 |     Total
-----------------+----------------------+----------
1 least deprived |     5,187        709 |     5,896 
                 |     87.97      12.03 |    100.00 
-----------------+----------------------+----------
               2 |     5,069        748 |     5,817 
                 |     87.14      12.86 |    100.00 
-----------------+----------------------+----------
               3 |     5,093        708 |     5,801 
                 |     87.80      12.20 |    100.00 
-----------------+----------------------+----------
               4 |     4,735        716 |     5,451 
                 |     86.86      13.14 |    100.00 
-----------------+----------------------+----------
 5 most deprived |     4,609        716 |     5,325 
                 |     86.55      13.45 |    100.00 
-----------------+----------------------+----------
           Total |    24,693      3,597 |    28,290 
                 |     87.29      12.71 |    100.00 

. tab agegroup dmard_pc if sle == 1, m row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

 RECODE of |       dmard_pc
       age |         0          1 |     Total
-----------+----------------------+----------
    18-<40 |     3,179        592 |     3,771 
           |     84.30      15.70 |    100.00 
-----------+----------------------+----------
    40-<50 |     3,816        697 |     4,513 
           |     84.56      15.44 |    100.00 
-----------+----------------------+----------
    50-<60 |     5,647        883 |     6,530 
           |     86.48      13.52 |    100.00 
-----------+----------------------+----------
    60-<70 |     5,322        733 |     6,055 
           |     87.89      12.11 |    100.00 
-----------+----------------------+----------
    70-<80 |     4,534        522 |     5,056 
           |     89.68      10.32 |    100.00 
-----------+----------------------+----------
       80+ |     2,195        170 |     2,365 
           |     92.81       7.19 |    100.00 
-----------+----------------------+----------
     Total |    24,693      3,597 |    28,290 
           |     87.29      12.71 |    100.00 

. 
end of do-file

. 
. 
. 
. 
. 
. 
. 
. 
. * =====        SENSITIVITY 1: Non-COVID death       =========================
> ========================;
. clear 

. cd ..
E:\analyses\hydroxychloroquine-research

. import delimited `c(pwd)'/output/input.csv, clear
(58 vars, 194,251 obs)

. set more off 

. 
. *set filepaths
. global Projectdir `c(pwd)'

. di "$Projectdir"
E:\analyses\hydroxychloroquine-research

. global Dodir "$Projectdir/analysis" 

. di "$Dodir"
E:\analyses\hydroxychloroquine-research/analysis

. global Outdir "$Projectdir/output" 

. di "$Outdir"
E:\analyses\hydroxychloroquine-research/output

. global Logdir "$Projectdir/output/sens1/log"

. di "$Logdir"
E:\analyses\hydroxychloroquine-research/output/sens1/log

. global Tempdir "$Projectdir/output/sens1/tempdata" 

. di "$Tempdir"
E:\analyses\hydroxychloroquine-research/output/sens1/tempdata

. global Tabfigdir "$Projectdir/output/sens1/tabfig" 

. di "$Tabfigdir"
E:\analyses\hydroxychloroquine-research/output/sens1/tabfig

. 
. * Create directories required  --- ANY OUTPUT STATA MAKES SHOULD BE PUT INTO 
> OUTPUT FOLDER FROM ROOT DIRECTORY
. 
. capture mkdir "$Outdir/sens1" 

. capture mkdir "$Outdir/sens1/log"

. capture mkdir "$Outdir/sens1/tempdata"

. capture mkdir "$Outdir/sens1/tabfig"

. 
. * Set globals that will print in programs and direct output
. 
. global outcome    "onsnoncoviddeath"

. global tableoutcome "Non COVID-19 Death in ONS"

. global ymax 0.01

. 
. * all variables included in fully adjusted models
. global varlist "exposure male agegroup dmard_pc oral_prednisolone chronic_car
> diac_disease resp_excl_asthma egfr_cat_nomiss chronic_liver_disease obese4cat
>  hypertension cancer_ever neuro_conditions"

. 
. pwd
E:\analyses\hydroxychloroquine-research

. cd  "$Dodir"
E:\analyses\hydroxychloroquine-research\analysis

. 
. /*  Pre-analysis data manipulation  */
. do "00_cr_create_analysis_dataset.do"

. /*===========================================================================
> ===
> DO FILE NAME:                   00_cr_create_analysis_dataset
> PROJECT:                                HCQ in COVID-19 
> DATE:                                   17 June 2020 
> AUTHOR:                                 C Rentsch
>                                                 adapted from A Schultze      
>                                                                            
> DESCRIPTION OF FILE:    program 00, data management for HCQ project  
>                                                 reformat variables 
>                                                 categorise variables
>                                                 label variables 
> DATASETS USED:                  data in memory (from output/input.csv)
> 
> DATASETS CREATED:               none
> OTHER OUTPUT:                   logfiles, printed to folder $Logdir
> USER-INSTALLED ADO:      
>   (place .ado file(s) in analysis folder)                                    
>            
> =============================================================================
> =*/
. 
. * Open a log file
. 
. cap log close
