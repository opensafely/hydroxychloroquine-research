-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens3/log\08_an_mod
> el_checks.log
  log type:  text
 opened on:  17 Aug 2020, 11:03:54

. 
. * Open Stata dataset
. use $Tempdir\analysis_dataset_STSET_$outcome, clear

. 
. * Exposure labels 
. local lab1: label exposure 1

. 
. /* Quietly run models, perform test and store results in local macro=========
> =*/
. 
. qui stcox i.exposure 

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.04074         2.35        1         0.1256
      ------------+---------------------------------------------------
      global test |                      2.35        1         0.1256
      ----------------------------------------------------------------

. local univar_p1 = round(r(phtest)[2,4],0.001)

. 
. di `univar_p1'
.126

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) ///
>                           title ("Schoenfeld residuals against time, Univaria
> ble `lab1'", position(11) size(medsmall)) 

. 
. graph export "$Tabfigdir/schoenplot1a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens3/tabfig/schoenplot1a.
> svg written in SVG format)

. 
. * Close window 
. graph close  

.                           
. stcox i.exposure i.male age1 age2 age3 

         failure _d:  firstpos_primcare
   analysis time _t:  (stime_firstpos_primcare-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17195.328
Iteration 1:   log likelihood = -17113.293
Iteration 2:   log likelihood = -17084.032
Iteration 3:   log likelihood = -17083.479
Iteration 4:   log likelihood = -17083.479
Refining estimates:
Iteration 0:   log likelihood = -17083.479

Cox regression -- Breslow method for ties

No. of subjects =      195,014                  Number of obs    =     195,014
No. of failures =        1,414
Time at risk    =     30117196
                                                LR chi2(5)       =      223.70
Log likelihood  =   -17083.479                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9915697   .0755564    -0.11   0.912     .8540095    1.151287
      1.male |   1.135261   .0651259     2.21   0.027     1.014531    1.270358
        age1 |   1.004674   .0068458     0.68   0.494     .9913458    1.018182
        age2 |   .9959617    .013825    -0.29   0.771     .9692305     1.02343
        age3 |   1.181068   .0787682     2.50   0.013      1.03635    1.345995
------------------------------------------------------------------------------

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.03391         1.61        1         0.2049
      0b.male     |            .            .        1             .
      1.male      |     -0.03247         1.47        1         0.2246
      age1        |     -0.05430         3.73        1         0.0534
      age2        |     -0.00088         0.00        1         0.9744
      age3        |      0.02030         0.56        1         0.4563
      ------------+---------------------------------------------------
      global test |                     27.90        5         0.0000
      ----------------------------------------------------------------

. local multivar1_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) ///
>                           title ("Schoenfeld residuals against time, Age/Sex 
> Adjusted `lab1'", position(11) size(medsmall))                       

. 
. graph export "$Tabfigdir/schoenplot2a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens3/tabfig/schoenplot2a.
> svg written in SVG format)

. 
. * Close window 
. graph close

.                   
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone, strata
> (stp population)

         failure _d:  firstpos_primcare
   analysis time _t:  (stime_firstpos_primcare-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -12178.597
Iteration 1:   log likelihood = -12059.778
Iteration 2:   log likelihood = -12029.857
Iteration 3:   log likelihood = -12029.378
Iteration 4:   log likelihood = -12029.378
Refining estimates:
Iteration 0:   log likelihood = -12029.378

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      195,014                  Number of obs    =     195,014
No. of failures =        1,414
Time at risk    =     30117196
                                                LR chi2(7)       =      298.44
Log likelihood  =   -12029.378                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9459172   .0734816    -0.72   0.474     .8123241    1.101481
      1.male |   1.141008   .0657263     2.29   0.022     1.019192    1.277382
        age1 |   1.005279   .0068928     0.77   0.443     .9918596     1.01888
        age2 |   .9914087   .0138319    -0.62   0.536     .9646659    1.018893
        age3 |   1.212879    .081484     2.87   0.004     1.063241    1.383576
  1.dmard_pc |   1.099511    .062369     1.67   0.094     .9838198    1.228806
1.oral_pr~ne |   1.673038   .1016336     8.47   0.000     1.485242     1.88458
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.02955         1.23        1         0.2673
      0b.male     |            .            .        1             .
      1.male      |     -0.03417         1.64        1         0.1999
      age1        |     -0.05494         3.83        1         0.0504
      age2        |      0.00021         0.00        1         0.9940
      age3        |      0.01968         0.52        1         0.4688
      0b.dmard_pc |            .            .        1             .
      1.dmard_pc  |      0.00187         0.01        1         0.9434
      0b.oral_p~ne|            .            .        1             .
      1.oral_pr~ne|     -0.07015         6.95        1         0.0084
      ------------+---------------------------------------------------
      global test |                     35.25        7         0.0000
      ----------------------------------------------------------------

. local multivar2_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) /// 
>                           title ("Schoenfeld residuals against time, DAG Adju
> sted `lab1'", position(11) size(medsmall))                   

.                           
. graph export "$Tabfigdir/schoenplot3a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens3/tabfig/schoenplot3a.
> svg written in SVG format)

. 
. * Close window 
. graph close

. 
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone i.nsaid
> s i.chronic_cardiac_disease i.resp_excl_asthma i.egfr_cat_nomiss i.chronic_li
> ver_disease i.obese4cat i.hypertension i.cancer_ever i.neuro_conditions i.flu
> _vaccine i.imd i.diabcat i.smoke_nomiss, strata(stp population)

         failure _d:  firstpos_primcare
   analysis time _t:  (stime_firstpos_primcare-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -12178.597
Iteration 1:   log likelihood = -12036.227
Iteration 2:   log likelihood =  -11932.59
Iteration 3:   log likelihood = -11922.289
Iteration 4:   log likelihood = -11921.851
Iteration 5:   log likelihood = -11921.849
Refining estimates:
Iteration 0:   log likelihood = -11921.849

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      195,014                  Number of obs    =     195,014
No. of failures =        1,414
Time at risk    =     30117196
                                                LR chi2(29)      =      513.50
Log likelihood  =   -11921.849                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9314518   .0725853    -0.91   0.362      .799519    1.085156
      1.male |   1.093681   .0647857     1.51   0.131     .9737971    1.228323
        age1 |   1.001304   .0069247     0.19   0.851     .9878229    1.014968
        age2 |   .9809747   .0139555    -1.35   0.177     .9540002    1.008712
        age3 |   1.276873   .0875002     3.57   0.000     1.116394    1.460421
  1.dmard_pc |   1.154362   .0664195     2.49   0.013     1.031255    1.292166
1.oral_pr~ne |   1.488482   .0937332     6.32   0.000     1.315653    1.684014
    1.nsaids |   1.025108   .0799783     0.32   0.751     .8797501    1.194482
1.~c_disease |   1.257552   .0844617     3.41   0.001     1.102443    1.434484
1.resp_exc~a |   1.305591    .092538     3.76   0.000     1.136254    1.500164
             |
egfr_cat_n~s |
      30-59  |   1.050586   .0803099     0.65   0.519     .9044056    1.220394
        <30  |   2.140525    .326672     4.99   0.000     1.587142    2.886853
             |
1.~r_disease |   1.145508   .2369157     0.66   0.511     .7637501    1.718086
             |
   obese4cat |
Obese I ..)  |   1.130946   .0788034     1.77   0.077     .9865769    1.296442
Obese II..)  |   1.150672    .115103     1.40   0.161     .9458121    1.399904
Obese II..)  |   1.470333   .1806282     3.14   0.002     1.155705    1.870616
             |
1.hyperten~n |   1.041551   .0638802     0.66   0.507     .9235809     1.17459
1.cancer_e~r |   1.277357   .0981443     3.19   0.001     1.098781    1.484956
1.neuro_co~s |   1.504044   .1257529     4.88   0.000     1.276708     1.77186
1.flu_vacc~e |   1.053077   .0684083     0.80   0.426     .9271837    1.196064
             |
         imd |
          2  |   1.442925    .130367     4.06   0.000     1.208756     1.72246
          3  |   1.445619   .1333889     3.99   0.000     1.206459    1.732188
          4  |   1.487549    .137871     4.28   0.000      1.24045    1.783871
5 most de..  |   1.772948   .1637397     6.20   0.000     1.479394    2.124752
             |
     diabcat |
Controlle..  |   1.217204    .092664     2.58   0.010     1.048486    1.413072
Uncontrol..  |   1.408383   .1485954     3.25   0.001     1.145281    1.731925
Diabetes,..  |   1.190862   .2216413     0.94   0.348     .8268697    1.715085
             |
smoke_nomiss |
     Former  |   1.013649   .0600985     0.23   0.819     .9024447    1.138557
    Current  |   .6286826   .0654501    -4.46   0.000     .5126437    .7709872
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.02855         1.15        1         0.2842
      0b.male     |            .            .        1             .
      1.male      |     -0.01559         0.34        1         0.5572
      age1        |     -0.04942         3.13        1         0.0769
      age2        |      0.01467         0.29        1         0.5912
      age3        |      0.00319         0.01        1         0.9064
      0b.dmard_pc |            .            .        1             .
      1.dmard_pc  |      0.00102         0.00        1         0.9692
      0b.oral_p~ne|            .            .        1             .
      1.oral_pr~ne|     -0.05357         4.07        1         0.0436
      0b.nsaids   |            .            .        1             .
      1.nsaids    |      0.01335         0.25        1         0.6138
      0b.chronic..|            .            .        1             .
      1.~c_disease|      0.00967         0.14        1         0.7127
      0b.resp_ex~a|            .            .        1             .
      1.resp_exc~a|     -0.04554         2.91        1         0.0880
      1b.egfr_ca~s|            .            .        1             .
      2.egfr_cat~s|      0.00090         0.00        1         0.9728
      3.egfr_cat~s|     -0.00019         0.00        1         0.9943
      0b.chronic..|            .            .        1             .
      1.~r_disease|      0.03665         1.91        1         0.1665
      1b.obese4cat|            .            .        1             .
      2.obese4cat |     -0.01112         0.18        1         0.6752
      3.obese4cat |      0.04496         2.86        1         0.0906
      4.obese4cat |      0.01482         0.31        1         0.5767
      0b.hyperte~n|            .            .        1             .
      1.hyperten~n|     -0.03276         1.56        1         0.2116
      0b.cancer_~r|            .            .        1             .
      1.cancer_e~r|     -0.02777         1.09        1         0.2961
      0b.neuro_c~s|            .            .        1             .
      1.neuro_co~s|     -0.00341         0.02        1         0.8984
      0b.flu_vac~e|            .            .        1             .
      1.flu_vacc~e|     -0.01026         0.16        1         0.6850
      1b.imd      |            .            .        1             .
      2.imd       |     -0.00221         0.01        1         0.9339
      3.imd       |      0.02003         0.56        1         0.4536
      4.imd       |      0.02081         0.61        1         0.4351
      5.imd       |      0.03835         2.06        1         0.1511
      1b.diabcat  |            .            .        1             .
      2.diabcat   |     -0.03099         1.32        1         0.2497
      3.diabcat   |     -0.00797         0.09        1         0.7632
      4.diabcat   |      0.03348         1.58        1         0.2082
      1b.smoke_n~s|            .            .        1             .
      2.smoke_no~s|     -0.04479         2.82        1         0.0931
      3.smoke_no~s|      0.00550         0.04        1         0.8326
      ------------+---------------------------------------------------
      global test |                     56.02       29         0.0019
      ----------------------------------------------------------------

. local multivar3_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) /// 
>                           title ("Schoenfeld residuals against time, Fully Ad
> justed `lab1'", position(11) size(medsmall))                 

.                           
. graph export "$Tabfigdir/schoenplot4a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens3/tabfig/schoenplot4a.
> svg written in SVG format)

. 
. * Close window 
. graph close

. 
. * Print table of results=====================================================
> =*/        
. 
. 
. cap file close tablecontent

. file open tablecontent using $Tabfigdir/table4.txt, write text replace

. 
. * Column headings 
. file write tablecontent ("Table 4: Testing the PH assumption for $tableoutcom
> e") _n

. file write tablecontent _tab ("Univariable") _tab ("Age/Sex Adjusted") _tab /
> //
>                                                 ("DAG Adjusted") _tab ("Fully
>  Adjusted") _tab _n

.                                                 
. file write tablecontent _tab ("p-value") _tab ("p-value") _tab ("p-value") _t
> ab ("p-value") _tab _n

. 
. * Row heading and content  
. file write tablecontent ("`lab1'") _tab

. file write tablecontent ("`univar_p1'") _tab ("`multivar1_p1'") _tab ("`multi
> var2_p1'") _tab ("`multivar3_p1'") _n

. 
. file write tablecontent _n

. file close tablecontent

. 
. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens3/log\08_an_mod
> el_checks.log
  log type:  text
 closed on:  17 Aug 2020, 11:05:48
-------------------------------------------------------------------------------
