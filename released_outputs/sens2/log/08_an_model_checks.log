-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens2/log\08_an_mod
> el_checks.log
  log type:  text
 opened on:  17 Aug 2020, 10:26:03

. 
. * Open Stata dataset
. use $Tempdir\analysis_dataset_STSET_$outcome, clear

. 
. * Exposure labels 
. local lab1: label exposure 1

. 
. /* Quietly run models, perform test and store results in local macro=========
> =*/
. 
. qui stcox i.exposure 

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.03228         1.44        1         0.2297
      ------------+---------------------------------------------------
      global test |                      1.44        1         0.2297
      ----------------------------------------------------------------

. local univar_p1 = round(r(phtest)[2,4],0.001)

. 
. di `univar_p1'
.23

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) ///
>                           title ("Schoenfeld residuals against time, Univaria
> ble `lab1'", position(11) size(medsmall)) 

. 
. graph export "$Tabfigdir/schoenplot1a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens2/tabfig/schoenplot1a.
> svg written in SVG format)

. 
. * Close window 
. graph close  

.                           
. stcox i.exposure i.male age1 age2 age3 

         failure _d:  firstpos_sgss
   analysis time _t:  (stime_firstpos_sgss-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -16845.524
Iteration 1:   log likelihood = -16748.837
Iteration 2:   log likelihood = -16616.054
Iteration 3:   log likelihood = -16611.085
Iteration 4:   log likelihood = -16611.071
Iteration 5:   log likelihood = -16611.071
Refining estimates:
Iteration 0:   log likelihood = -16611.071

Cox regression -- Breslow method for ties

No. of subjects =      195,020                  Number of obs    =     195,020
No. of failures =        1,385
Time at risk    =   29945718.5
                                                LR chi2(5)       =      468.91
Log likelihood  =   -16611.071                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9367614   .0752179    -0.81   0.416     .8003522     1.09642
      1.male |   1.213763   .0695371     3.38   0.001     1.084846       1.358
        age1 |   .9968206   .0071868    -0.44   0.659     .9828339    1.011006
        age2 |   1.019406   .0148317     1.32   0.186     .9907474    1.048895
        age3 |   1.111656   .0759168     1.55   0.121     .9723905    1.270868
------------------------------------------------------------------------------

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.02399         0.79        1         0.3736
      0b.male     |            .            .        1             .
      1.male      |     -0.04610         2.92        1         0.0872
      age1        |     -0.06158         4.74        1         0.0294
      age2        |     -0.01527         0.31        1         0.5788
      age3        |      0.04314         2.48        1         0.1150
      ------------+---------------------------------------------------
      global test |                     49.21        5         0.0000
      ----------------------------------------------------------------

. local multivar1_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) ///
>                           title ("Schoenfeld residuals against time, Age/Sex 
> Adjusted `lab1'", position(11) size(medsmall))                       

. 
. graph export "$Tabfigdir/schoenplot2a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens2/tabfig/schoenplot2a.
> svg written in SVG format)

. 
. * Close window 
. graph close

.                   
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone, strata
> (stp population)

         failure _d:  firstpos_sgss
   analysis time _t:  (stime_firstpos_sgss-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -11965.657
Iteration 1:   log likelihood = -11812.025
Iteration 2:   log likelihood = -11676.014
Iteration 3:   log likelihood = -11671.706
Iteration 4:   log likelihood = -11671.696
Iteration 5:   log likelihood = -11671.696
Refining estimates:
Iteration 0:   log likelihood = -11671.696

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      195,020                  Number of obs    =     195,020
No. of failures =        1,385
Time at risk    =   29945718.5
                                                LR chi2(7)       =      587.92
Log likelihood  =   -11671.696                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .8917522   .0727633    -1.40   0.160     .7599581    1.046402
      1.male |   1.221612   .0702512     3.48   0.000     1.091398    1.367361
        age1 |   .9974764   .0072286    -0.35   0.727     .9834087    1.011745
        age2 |    1.01385   .0148182     0.94   0.347     .9852185    1.043313
        age3 |   1.146464   .0788427     1.99   0.047     1.001897    1.311891
  1.dmard_pc |   .9779005   .0568646    -0.38   0.701     .8725646    1.095953
1.oral_pr~ne |    1.90472   .1128713    10.87   0.000      1.69586    2.139303
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.02093         0.61        1         0.4354
      0b.male     |            .            .        1             .
      1.male      |     -0.04861         3.25        1         0.0716
      age1        |     -0.06317         5.02        1         0.0251
      age2        |     -0.01300         0.22        1         0.6359
      age3        |      0.04197         2.36        1         0.1243
      0b.dmard_pc |            .            .        1             .
      1.dmard_pc  |      0.00615         0.05        1         0.8176
      0b.oral_p~ne|            .            .        1             .
      1.oral_pr~ne|     -0.09212        11.75        1         0.0006
      ------------+---------------------------------------------------
      global test |                     62.36        7         0.0000
      ----------------------------------------------------------------

. local multivar2_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) /// 
>                           title ("Schoenfeld residuals against time, DAG Adju
> sted `lab1'", position(11) size(medsmall))                   

.                           
. graph export "$Tabfigdir/schoenplot3a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens2/tabfig/schoenplot3a.
> svg written in SVG format)

. 
. * Close window 
. graph close

. 
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone i.nsaid
> s i.chronic_cardiac_disease i.resp_excl_asthma i.egfr_cat_nomiss i.chronic_li
> ver_disease i.obese4cat i.hypertension i.cancer_ever i.neuro_conditions i.flu
> _vaccine i.imd i.diabcat i.smoke_nomiss, strata(stp population)

         failure _d:  firstpos_sgss
   analysis time _t:  (stime_firstpos_sgss-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -11965.657
Iteration 1:   log likelihood = -11588.206
Iteration 2:   log likelihood = -11542.369
Iteration 3:   log likelihood = -11542.092
Iteration 4:   log likelihood = -11542.092
Refining estimates:
Iteration 0:   log likelihood = -11542.092

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      195,020                  Number of obs    =     195,020
No. of failures =        1,385
Time at risk    =   29945718.5
                                                LR chi2(29)      =      847.13
Log likelihood  =   -11542.092                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |    .891681   .0729784    -1.40   0.161     .7595286    1.046827
      1.male |   1.150915   .0680992     2.38   0.018     1.024892    1.292435
        age1 |   .9931767   .0072737    -0.93   0.350     .9790223    1.007536
        age2 |   1.006655    .015026     0.44   0.657     .9776307     1.03654
        age3 |   1.180714   .0829935     2.36   0.018     1.028757    1.355116
  1.dmard_pc |   1.056903   .0623394     0.94   0.348     .9415181    1.186429
1.oral_pr~ne |    1.75117   .1074094     9.13   0.000     1.552813    1.974865
    1.nsaids |   1.011034   .0838603     0.13   0.895     .8593357    1.189512
1.~c_disease |   1.225906   .0804311     3.10   0.002     1.077979    1.394133
1.resp_exc~a |   1.160693   .0824262     2.10   0.036      1.00988    1.334029
             |
egfr_cat_n~s |
      30-59  |   1.107987   .0805011     1.41   0.158     .9609266    1.277553
        <30  |    2.26795   .3130457     5.93   0.000     1.730382    2.972521
             |
1.~r_disease |   1.033768   .2231862     0.15   0.878     .6770993    1.578316
             |
   obese4cat |
Obese I ..)  |   1.168366   .0820486     2.22   0.027      1.01813    1.340771
Obese II..)  |   1.244399   .1252961     2.17   0.030     1.021537    1.515883
Obese II..)  |   1.442713   .1887231     2.80   0.005     1.116435    1.864347
             |
1.hyperten~n |   1.025214   .0638776     0.40   0.689     .9073585    1.158377
1.cancer_e~r |   1.171215   .0902502     2.05   0.040     1.007037    1.362158
1.neuro_co~s |   1.718887   .1331024     7.00   0.000     1.476843      2.0006
1.flu_vacc~e |   .8821221   .0570577    -1.94   0.052     .7770894    1.001351
             |
         imd |
          2  |   1.081484   .0981936     0.86   0.388     .9051799    1.292126
          3  |   1.237022   .1109418     2.37   0.018     1.037619    1.474745
          4  |   1.219574    .110639     2.19   0.029      1.02091    1.456896
5 most de..  |   1.447852   .1298318     4.13   0.000     1.214494    1.726049
             |
     diabcat |
Controlle..  |   1.294277    .096463     3.46   0.001     1.118373    1.497848
Uncontrol..  |   1.610542   .1632093     4.70   0.000     1.320422    1.964405
Diabetes,..  |   1.853806   .2878157     3.98   0.000     1.367445    2.513154
             |
smoke_nomiss |
     Former  |   1.162318   .0702451     2.49   0.013     1.032482    1.308482
    Current  |   .6103689   .0697083    -4.32   0.000     .4879545    .7634937
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.02235         0.69        1         0.4053
      0b.male     |            .            .        1             .
      1.male      |     -0.03735         1.93        1         0.1653
      age1        |     -0.06116         4.65        1         0.0310
      age2        |     -0.00468         0.03        1         0.8647
      age3        |      0.03173         1.35        1         0.2445
      0b.dmard_pc |            .            .        1             .
      1.dmard_pc  |      0.01149         0.19        1         0.6666
      0b.oral_p~ne|            .            .        1             .
      1.oral_pr~ne|     -0.08479        10.17        1         0.0014
      0b.nsaids   |            .            .        1             .
      1.nsaids    |      0.00971         0.13        1         0.7200
      0b.chronic..|            .            .        1             .
      1.~c_disease|      0.02605         0.95        1         0.3285
      0b.resp_ex~a|            .            .        1             .
      1.resp_exc~a|     -0.01921         0.51        1         0.4763
      1b.egfr_ca~s|            .            .        1             .
      2.egfr_cat~s|     -0.01484         0.32        1         0.5739
      3.egfr_cat~s|     -0.02085         0.64        1         0.4233
      0b.chronic..|            .            .        1             .
      1.~r_disease|      0.01701         0.40        1         0.5251
      1b.obese4cat|            .            .        1             .
      2.obese4cat |     -0.06453         5.77        1         0.0163
      3.obese4cat |      0.03291         1.50        1         0.2199
      4.obese4cat |     -0.01559         0.34        1         0.5592
      0b.hyperte~n|            .            .        1             .
      1.hyperten~n|     -0.00183         0.00        1         0.9450
      0b.cancer_~r|            .            .        1             .
      1.cancer_e~r|     -0.02643         0.98        1         0.3212
      0b.neuro_c~s|            .            .        1             .
      1.neuro_co~s|      0.01412         0.28        1         0.5992
      0b.flu_vac~e|            .            .        1             .
      1.flu_vacc~e|     -0.02982         1.30        1         0.2536
      1b.imd      |            .            .        1             .
      2.imd       |      0.02766         1.06        1         0.3041
      3.imd       |      0.06580         5.99        1         0.0144
      4.imd       |      0.07298         7.38        1         0.0066
      5.imd       |      0.10971        16.80        1         0.0000
      1b.diabcat  |            .            .        1             .
      2.diabcat   |      0.03564         1.72        1         0.1891
      3.diabcat   |      0.02515         0.88        1         0.3490
      4.diabcat   |      0.00852         0.10        1         0.7509
      1b.smoke_n~s|            .            .        1             .
      2.smoke_no~s|     -0.03666         1.84        1         0.1755
      3.smoke_no~s|     -0.01644         0.38        1         0.5371
      ------------+---------------------------------------------------
      global test |                     99.97       29         0.0000
      ----------------------------------------------------------------

. local multivar3_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) /// 
>                           title ("Schoenfeld residuals against time, Fully Ad
> justed `lab1'", position(11) size(medsmall))                 

.                           
. graph export "$Tabfigdir/schoenplot4a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens2/tabfig/schoenplot4a.
> svg written in SVG format)

. 
. * Close window 
. graph close

. 
. * Print table of results=====================================================
> =*/        
. 
. 
. cap file close tablecontent

. file open tablecontent using $Tabfigdir/table4.txt, write text replace

. 
. * Column headings 
. file write tablecontent ("Table 4: Testing the PH assumption for $tableoutcom
> e") _n

. file write tablecontent _tab ("Univariable") _tab ("Age/Sex Adjusted") _tab /
> //
>                                                 ("DAG Adjusted") _tab ("Fully
>  Adjusted") _tab _n

.                                                 
. file write tablecontent _tab ("p-value") _tab ("p-value") _tab ("p-value") _t
> ab ("p-value") _tab _n

. 
. * Row heading and content  
. file write tablecontent ("`lab1'") _tab

. file write tablecontent ("`univar_p1'") _tab ("`multivar1_p1'") _tab ("`multi
> var2_p1'") _tab ("`multivar3_p1'") _n

. 
. file write tablecontent _n

. file close tablecontent

. 
. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens2/log\08_an_mod
> el_checks.log
  log type:  text
 closed on:  17 Aug 2020, 10:27:58
-------------------------------------------------------------------------------
