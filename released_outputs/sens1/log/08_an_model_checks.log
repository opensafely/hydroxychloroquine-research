-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens1/log\08_an_mod
> el_checks.log
  log type:  text
 opened on:  28 Aug 2020, 12:22:11

. 
. * Open Stata dataset
. use $Tempdir\analysis_dataset_STSET_$outcome, clear

. 
. * Exposure labels 
. local lab1: label exposure 1

. 
. /* Quietly run models, perform test and store results in local macro=========
> =*/
. 
. qui stcox i.exposure 

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.01442         0.42        1         0.5186
      ------------+---------------------------------------------------
      global test |                      0.42        1         0.5186
      ----------------------------------------------------------------

. local univar_p1 = round(r(phtest)[2,4],0.001)

. 
. di `univar_p1'
.519

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) ///
>                           title ("Schoenfeld residuals against time, Univaria
> ble `lab1'", position(11) size(medsmall)) 

. 
. graph export "$Tabfigdir/schoenplot1a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens1/tabfig/schoenplot1a.
> svg written in SVG format)

. 
. * Close window 
. graph close  

.                           
. stcox i.exposure i.male age1 age2 age3 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -24361.893
Iteration 1:   log likelihood = -23209.477
Iteration 2:   log likelihood = -22997.781
Iteration 3:   log likelihood = -22984.572
Iteration 4:   log likelihood = -22983.074
Iteration 5:   log likelihood = -22983.023
Iteration 6:   log likelihood = -22983.022
Refining estimates:
Iteration 0:   log likelihood = -22983.022

Cox regression -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(5)       =     2757.74
Log likelihood  =   -22983.022                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9994149   .0700884    -0.01   0.993     .8710669    1.146674
      1.male |   1.244853   .0590071     4.62   0.000     1.134411    1.366048
        age1 |   1.061167   .0187132     3.37   0.001     1.025116    1.098485
        age2 |   1.039349   .0270178     1.48   0.138     .9877214    1.093675
        age3 |    .919096   .0914212    -0.85   0.396     .7562981    1.116937
------------------------------------------------------------------------------

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.01023         0.21        1         0.6463
      0b.male     |            .            .        1             .
      1.male      |     -0.06294         7.87        1         0.0050
      age1        |     -0.02901         2.58        1         0.1084
      age2        |      0.03665         3.85        1         0.0497
      age3        |     -0.04207         4.77        1         0.0289
      ------------+---------------------------------------------------
      global test |                     14.07        5         0.0152
      ----------------------------------------------------------------

. local multivar1_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) ///
>                           title ("Schoenfeld residuals against time, Age/Sex 
> Adjusted `lab1'", position(11) size(medsmall))                       

. 
. graph export "$Tabfigdir/schoenplot2a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens1/tabfig/schoenplot2a.
> svg written in SVG format)

. 
. * Close window 
. graph close

.                   
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone, strata
> (stp population)

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17345.108
Iteration 1:   log likelihood = -16104.643
Iteration 2:   log likelihood = -15894.973
Iteration 3:   log likelihood = -15881.176
Iteration 4:   log likelihood = -15879.737
Iteration 5:   log likelihood =  -15879.69
Iteration 6:   log likelihood =  -15879.69
Refining estimates:
Iteration 0:   log likelihood =  -15879.69

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(7)       =     2930.84
Log likelihood  =    -15879.69                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   1.000759   .0709099     0.01   0.991     .8709972    1.149853
      1.male |    1.24892   .0594048     4.67   0.000     1.137751    1.370952
        age1 |   1.062336   .0187209     3.43   0.001     1.026271     1.09967
        age2 |   1.032564   .0268384     1.23   0.218     .9812788    1.086529
        age3 |   .9411034   .0937279    -0.61   0.542     .7742178    1.143962
  1.dmard_pc |   .6753384   .0344638    -7.69   0.000     .6110587    .7463799
1.oral_pr~ne |   2.027964    .096421    14.87   0.000     1.847521    2.226032
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.00424         0.04        1         0.8503
      0b.male     |            .            .        1             .
      1.male      |     -0.06157         7.56        1         0.0060
      age1        |     -0.02852         2.48        1         0.1152
      age2        |      0.03614         3.73        1         0.0533
      age3        |     -0.04105         4.53        1         0.0334
      0b.dmard_pc |            .            .        1             .
      1.dmard_pc  |      0.04012         3.22        1         0.0729
      0b.oral_p~ne|            .            .        1             .
      1.oral_pr~ne|     -0.01201         0.29        1         0.5889
      ------------+---------------------------------------------------
      global test |                     16.55        7         0.0206
      ----------------------------------------------------------------

. local multivar2_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) /// 
>                           title ("Schoenfeld residuals against time, DAG Adju
> sted `lab1'", position(11) size(medsmall))                   

.                           
. graph export "$Tabfigdir/schoenplot3a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens1/tabfig/schoenplot3a.
> svg written in SVG format)

. 
. * Close window 
. graph close

. 
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone i.nsaid
> s i.chronic_cardiac_disease i.resp_excl_asthma i.egfr_cat_nomiss i.chronic_li
> ver_disease i.obese4cat i.hypertension i.cancer_ever i.neuro_conditions i.flu
> _vaccine i.imd i.diabcat i.smoke_nomiss, strata(stp population)

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17345.108
Iteration 1:   log likelihood = -15838.242
Iteration 2:   log likelihood = -15482.185
Iteration 3:   log likelihood = -15464.663
Iteration 4:   log likelihood =  -15463.87
Iteration 5:   log likelihood = -15463.859
Iteration 6:   log likelihood = -15463.859
Refining estimates:
Iteration 0:   log likelihood = -15463.859

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(29)      =     3762.50
Log likelihood  =   -15463.859                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   1.013382   .0719347     0.19   0.851     .8817614    1.164651
      1.male |   1.048536   .0515829     0.96   0.335     .9521567    1.154671
        age1 |   1.058226   .0187287     3.20   0.001     1.022147    1.095577
        age2 |   1.020665   .0267485     0.78   0.435     .9695624    1.074461
        age3 |   .9916329   .0998156    -0.08   0.933      .814087      1.2079
  1.dmard_pc |   .7732542   .0399016    -4.98   0.000     .6988733    .8555515
1.oral_pr~ne |     1.7119   .0842422    10.92   0.000       1.5545    1.885236
    1.nsaids |   .9719084   .0810357    -0.34   0.733       .82538     1.14445
1.~c_disease |   1.614791   .0786793     9.84   0.000     1.467717    1.776603
1.resp_exc~a |   1.514555   .0786342     8.00   0.000     1.368017     1.67679
             |
egfr_cat_n~s |
      30-59  |    1.05443   .0562221     0.99   0.320     .9497991    1.170587
        <30  |   2.346265   .2213845     9.04   0.000     1.950119    2.822885
             |
1.~r_disease |   1.932544   .2641161     4.82   0.000     1.478419    2.526161
             |
   obese4cat |
Obese I ..)  |   .6781565    .047803    -5.51   0.000     .5906484    .7786295
Obese II..)  |   .8813567   .0891385    -1.25   0.212     .7228747    1.074584
Obese II..)  |   1.032862    .148625     0.22   0.822     .7790357    1.369389
             |
1.hyperten~n |   1.045939   .0533812     0.88   0.379     .9463759    1.155976
1.cancer_e~r |   2.125211   .1059322    15.12   0.000     1.927407    2.343314
1.neuro_co~s |   1.707757   .0961912     9.50   0.000      1.52926    1.907089
1.flu_vacc~e |   .7657349   .0413685    -4.94   0.000     .6887992    .8512639
             |
         imd |
          2  |   1.210312   .0897344     2.57   0.010     1.046617    1.399609
          3  |   1.281782   .0954255     3.33   0.001     1.107756    1.483146
          4  |   1.247618   .0950124     2.91   0.004     1.074629    1.448455
5 most de..  |   1.487375   .1133839     5.21   0.000     1.280952    1.727064
             |
     diabcat |
Controlle..  |   1.098289   .0671426     1.53   0.125     .9742707    1.238095
Uncontrol..  |   1.407489   .1215083     3.96   0.000     1.188396    1.666976
Diabetes,..  |   1.838258    .223807     5.00   0.000     1.448015    2.333672
             |
smoke_nomiss |
     Former  |   1.133198   .0600549     2.36   0.018     1.021399    1.257233
    Current  |   1.806023   .1427139     7.48   0.000     1.546894    2.108561
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estat phtest, detail

      Test of proportional-hazards assumption

      Time:  Time
      ----------------------------------------------------------------
                  |       rho            chi2       df       Prob>chi2
      ------------+---------------------------------------------------
      0b.exposure |            .            .        1             .
      1.exposure  |      0.00592         0.07        1         0.7922
      0b.male     |            .            .        1             .
      1.male      |     -0.05960         7.07        1         0.0079
      age1        |     -0.02661         2.17        1         0.1405
      age2        |      0.03549         3.62        1         0.0571
      age3        |     -0.04135         4.64        1         0.0313
      0b.dmard_pc |            .            .        1             .
      1.dmard_pc  |      0.03661         2.72        1         0.0994
      0b.oral_p~ne|            .            .        1             .
      1.oral_pr~ne|     -0.00643         0.09        1         0.7705
      0b.nsaids   |            .            .        1             .
      1.nsaids    |     -0.00599         0.07        1         0.7884
      0b.chronic..|            .            .        1             .
      1.~c_disease|     -0.03421         2.48        1         0.1156
      0b.resp_ex~a|            .            .        1             .
      1.resp_exc~a|     -0.01569         0.51        1         0.4761
      1b.egfr_ca~s|            .            .        1             .
      2.egfr_cat~s|      0.02461         1.23        1         0.2669
      3.egfr_cat~s|     -0.02807         1.69        1         0.1934
      0b.chronic..|            .            .        1             .
      1.~r_disease|     -0.02294         1.05        1         0.3046
      1b.obese4cat|            .            .        1             .
      2.obese4cat |     -0.03594         2.59        1         0.1074
      3.obese4cat |     -0.00782         0.12        1         0.7266
      4.obese4cat |     -0.02242         1.00        1         0.3179
      0b.hyperte~n|            .            .        1             .
      1.hyperten~n|     -0.02834         1.65        1         0.1985
      0b.cancer_~r|            .            .        1             .
      1.cancer_e~r|      0.00672         0.10        1         0.7566
      0b.neuro_c~s|            .            .        1             .
      1.neuro_co~s|      0.03933         3.20        1         0.0737
      0b.flu_vac~e|            .            .        1             .
      1.flu_vacc~e|      0.00338         0.02        1         0.8756
      1b.imd      |            .            .        1             .
      2.imd       |     -0.00437         0.04        1         0.8447
      3.imd       |     -0.01008         0.20        1         0.6526
      4.imd       |      0.01435         0.41        1         0.5200
      5.imd       |      0.00526         0.06        1         0.8138
      1b.diabcat  |            .            .        1             .
      2.diabcat   |      0.01336         0.36        1         0.5466
      3.diabcat   |      0.01382         0.39        1         0.5337
      4.diabcat   |     -0.03497         2.44        1         0.1183
      1b.smoke_n~s|            .            .        1             .
      2.smoke_no~s|      0.00145         0.00        1         0.9483
      3.smoke_no~s|     -0.00151         0.00        1         0.9464
      ------------+---------------------------------------------------
      global test |                     38.44       29         0.1129
      ----------------------------------------------------------------

. local multivar3_p1 = round(r(phtest)[2,4],0.001)

.  
. estat phtest, plot(1.exposure) ///
>                           graphregion(fcolor(white)) ///
>                           ylabel(, nogrid labsize(small)) ///
>                           xlabel(, labsize(small)) ///
>                           xtitle("Time", size(small)) ///
>                           ytitle("Scaled Shoenfeld Residuals", size(small)) /
> //
>                           msize(small) ///
>                           mcolor(gs6) ///
>                           msymbol(circle_hollow) ///
>                           scheme(s1mono) /// 
>                           title ("Schoenfeld residuals against time, Fully Ad
> justed `lab1'", position(11) size(medsmall))                 

.                           
. graph export "$Tabfigdir/schoenplot4a.svg", as(svg) replace
(file E:\analyses\hydroxychloroquine-research/output/sens1/tabfig/schoenplot4a.
> svg written in SVG format)

. 
. * Close window 
. graph close

. 
. * Print table of results=====================================================
> =*/        
. 
. 
. cap file close tablecontent

. file open tablecontent using $Tabfigdir/table4.txt, write text replace

. 
. * Column headings 
. file write tablecontent ("Table 4: Testing the PH assumption for $tableoutcom
> e") _n

. file write tablecontent _tab ("Univariable") _tab ("Age/Sex Adjusted") _tab /
> //
>                                                 ("DAG Adjusted") _tab ("Fully
>  Adjusted") _tab _n

.                                                 
. file write tablecontent _tab ("p-value") _tab ("p-value") _tab ("p-value") _t
> ab ("p-value") _tab _n

. 
. * Row heading and content  
. file write tablecontent ("`lab1'") _tab

. file write tablecontent ("`univar_p1'") _tab ("`multivar1_p1'") _tab ("`multi
> var2_p1'") _tab ("`multivar3_p1'") _n

. 
. file write tablecontent _n

. file close tablecontent

. 
. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens1/log\08_an_mod
> el_checks.log
  log type:  text
 closed on:  28 Aug 2020, 12:24:25
-------------------------------------------------------------------------------
