-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens1/log\10_an_mod
> els_ethnicity.log
  log type:  text
 opened on:   6 Oct 2020, 13:23:36

. 
. * Open Stata dataset
. use $Tempdir\analysis_dataset_STSET_$outcome, clear

. 
. 
. 
. 
. 
. 
. *****************************************************************************
> *****************************************************************************
> ******************************
. *****************************************************************************
> *****************************************************************************
> ******************************
. /* Main Model (without adjusting for ethnicity) ======*/
. /* Univariable model */ 
. stcox i.exposure 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -24361.893
Iteration 1:   log likelihood =  -24347.74
Iteration 2:   log likelihood =  -24347.56
Iteration 3:   log likelihood =  -24347.56
Refining estimates:
Iteration 0:   log likelihood =  -24347.56

Cox regression -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(1)       =       28.67
Log likelihood  =    -24347.56                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .7005092   .0487285    -5.12   0.000     .6112276    .8028322
------------------------------------------------------------------------------

. estimates save $Tempdir/univar_eth1, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/univar_eth1.
> ster saved

. /* Multivariable models */ 
. * Age and Sex 
. * Age fit as spline 
. stcox i.exposure i.male age1 age2 age3 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -24361.893
Iteration 1:   log likelihood = -23209.477
Iteration 2:   log likelihood = -22997.781
Iteration 3:   log likelihood = -22984.572
Iteration 4:   log likelihood = -22983.074
Iteration 5:   log likelihood = -22983.023
Iteration 6:   log likelihood = -22983.022
Refining estimates:
Iteration 0:   log likelihood = -22983.022

Cox regression -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(5)       =     2757.74
Log likelihood  =   -22983.022                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9994149   .0700884    -0.01   0.993     .8710669    1.146674
      1.male |   1.244853   .0590071     4.62   0.000     1.134411    1.366048
        age1 |   1.061167   .0187132     3.37   0.001     1.025116    1.098485
        age2 |   1.039349   .0270178     1.48   0.138     .9877214    1.093675
        age3 |    .919096   .0914212    -0.85   0.396     .7562981    1.116937
------------------------------------------------------------------------------

. estimates save $Tempdir/multivar1_eth1, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar1_et
> h1.ster saved

. * DAG adjusted (age, sex, geographic region, other immunosuppressives (will i
> nclude biologics when we have them))  
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone, strata
> (stp population)                           

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17345.108
Iteration 1:   log likelihood = -16104.643
Iteration 2:   log likelihood = -15894.973
Iteration 3:   log likelihood = -15881.176
Iteration 4:   log likelihood = -15879.737
Iteration 5:   log likelihood =  -15879.69
Iteration 6:   log likelihood =  -15879.69
Refining estimates:
Iteration 0:   log likelihood =  -15879.69

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(7)       =     2930.84
Log likelihood  =    -15879.69                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   1.000759   .0709099     0.01   0.991     .8709972    1.149853
      1.male |    1.24892   .0594048     4.67   0.000     1.137751    1.370952
        age1 |   1.062336   .0187209     3.43   0.001     1.026271     1.09967
        age2 |   1.032564   .0268384     1.23   0.218     .9812788    1.086529
        age3 |   .9411034   .0937279    -0.61   0.542     .7742178    1.143962
  1.dmard_pc |   .6753384   .0344638    -7.69   0.000     .6110587    .7463799
1.oral_pr~ne |   2.027964    .096421    14.87   0.000     1.847521    2.226032
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estimates save $Tempdir/multivar2_eth1, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar2_et
> h1.ster saved

. * DAG+ other adjustments (NSAIDs, heart disease, lung disease, kidney disease
> , liver disease, BMI, hypertension, cancer, stroke, dementia, and respiratory
>  disease excl asthma (OCS capturing ashtma))
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone i.nsaid
> s i.chronic_cardiac_disease i.resp_excl_asthma i.egfr_cat_nomiss i.chronic_li
> ver_disease i.obese4cat i.hypertension i.cancer_ever i.neuro_conditions i.flu
> _vaccine i.imd i.diabcat i.smoke_nomiss, strata(stp population)  

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17345.108
Iteration 1:   log likelihood = -15838.242
Iteration 2:   log likelihood = -15482.185
Iteration 3:   log likelihood = -15464.663
Iteration 4:   log likelihood =  -15463.87
Iteration 5:   log likelihood = -15463.859
Iteration 6:   log likelihood = -15463.859
Refining estimates:
Iteration 0:   log likelihood = -15463.859

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      194,637                  Number of obs    =     194,637
No. of failures =        2,003
Time at risk    =   25636621.5
                                                LR chi2(29)      =     3762.50
Log likelihood  =   -15463.859                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   1.013382   .0719347     0.19   0.851     .8817614    1.164651
      1.male |   1.048536   .0515829     0.96   0.335     .9521567    1.154671
        age1 |   1.058226   .0187287     3.20   0.001     1.022147    1.095577
        age2 |   1.020665   .0267485     0.78   0.435     .9695624    1.074461
        age3 |   .9916329   .0998156    -0.08   0.933      .814087      1.2079
  1.dmard_pc |   .7732542   .0399016    -4.98   0.000     .6988733    .8555515
1.oral_pr~ne |     1.7119   .0842422    10.92   0.000       1.5545    1.885236
    1.nsaids |   .9719084   .0810357    -0.34   0.733       .82538     1.14445
1.~c_disease |   1.614791   .0786793     9.84   0.000     1.467717    1.776603
1.resp_exc~a |   1.514555   .0786342     8.00   0.000     1.368017     1.67679
             |
egfr_cat_n~s |
      30-59  |    1.05443   .0562221     0.99   0.320     .9497991    1.170587
        <30  |   2.346265   .2213845     9.04   0.000     1.950119    2.822885
             |
1.~r_disease |   1.932544   .2641161     4.82   0.000     1.478419    2.526161
             |
   obese4cat |
Obese I ..)  |   .6781565    .047803    -5.51   0.000     .5906484    .7786295
Obese II..)  |   .8813567   .0891385    -1.25   0.212     .7228747    1.074584
Obese II..)  |   1.032862    .148625     0.22   0.822     .7790357    1.369389
             |
1.hyperten~n |   1.045939   .0533812     0.88   0.379     .9463759    1.155976
1.cancer_e~r |   2.125211   .1059322    15.12   0.000     1.927407    2.343314
1.neuro_co~s |   1.707757   .0961912     9.50   0.000      1.52926    1.907089
1.flu_vacc~e |   .7657349   .0413685    -4.94   0.000     .6887992    .8512639
             |
         imd |
          2  |   1.210312   .0897344     2.57   0.010     1.046617    1.399609
          3  |   1.281782   .0954255     3.33   0.001     1.107756    1.483146
          4  |   1.247618   .0950124     2.91   0.004     1.074629    1.448455
5 most de..  |   1.487375   .1133839     5.21   0.000     1.280952    1.727064
             |
     diabcat |
Controlle..  |   1.098289   .0671426     1.53   0.125     .9742707    1.238095
Uncontrol..  |   1.407489   .1215083     3.96   0.000     1.188396    1.666976
Diabetes,..  |   1.838258    .223807     5.00   0.000     1.448015    2.333672
             |
smoke_nomiss |
     Former  |   1.133198   .0600549     2.36   0.018     1.021399    1.257233
    Current  |   1.806023   .1427139     7.48   0.000     1.546894    2.108561
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estimates save $Tempdir/multivar3_eth1, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar3_et
> h1.ster saved

. *****************************************************************************
> *****************************************************************************
> ******************************
. *****************************************************************************
> *****************************************************************************
> ******************************
. 
. 
. /* Restrict population=======================================================
> =*/ 
. drop if ethnicity == .u
(45,328 observations deleted)

. 
. /* Sense check outcomes======================================================
> =*/ 
. tab exposure $outcome, missing row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |   Failure/censoring
           |     indicator for
           |     outcome: ONS
       HCQ |    non-covid death
  Exposure |         0          1 |     Total
-----------+----------------------+----------
    No HCQ |   124,483      1,324 |   125,807 
           |     98.95       1.05 |    100.00 
-----------+----------------------+----------
       HCQ |    23,333        169 |    23,502 
           |     99.28       0.72 |    100.00 
-----------+----------------------+----------
     Total |   147,816      1,493 |   149,309 
           |     99.00       1.00 |    100.00 

. 
. *****************************************************************************
> *****************************************************************************
> ******************************
. *****************************************************************************
> *****************************************************************************
> ******************************
. /* Main Model (same adjustments, removing those with missing ethnicity) =====
> =*/
. /* Univariable model */ 
. stcox i.exposure 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17762.887
Iteration 1:   log likelihood = -17750.161
Iteration 2:   log likelihood = -17749.966
Iteration 3:   log likelihood = -17749.966
Refining estimates:
Iteration 0:   log likelihood = -17749.966

Cox regression -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(1)       =       25.84
Log likelihood  =   -17749.966                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |    .673865   .0550448    -4.83   0.000     .5741724    .7908671
------------------------------------------------------------------------------

. estimates save $Tempdir/univar_eth2, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/univar_eth2.
> ster saved

. /* Multivariable models */ 
. * Age and Sex 
. * Age fit as spline 
. stcox i.exposure i.male age1 age2 age3 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17762.887
Iteration 1:   log likelihood = -16894.593
Iteration 2:   log likelihood = -16720.131
Iteration 3:   log likelihood = -16712.006
Iteration 4:   log likelihood =  -16711.09
Iteration 5:   log likelihood = -16711.066
Iteration 6:   log likelihood = -16711.066
Refining estimates:
Iteration 0:   log likelihood = -16711.066

Cox regression -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(5)       =     2103.64
Log likelihood  =   -16711.066                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9577366   .0788196    -0.52   0.600     .8150685    1.125377
      1.male |   1.237918   .0680573     3.88   0.000     1.111463    1.378759
        age1 |   1.067263   .0216972     3.20   0.001     1.025573    1.110647
        age2 |   1.027404   .0307221     0.90   0.366     .9689204    1.089418
        age3 |   .9711166   .1109946    -0.26   0.798      .776216    1.214955
------------------------------------------------------------------------------

. estimates save $Tempdir/multivar1_eth2, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar1_et
> h2.ster saved

. * DAG adjusted (age, sex, geographic region, other immunosuppressives (will i
> nclude biologics when we have them))  
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone, strata
> (stp population)                           

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -12559.456
Iteration 1:   log likelihood = -11621.657
Iteration 2:   log likelihood =  -11455.65
Iteration 3:   log likelihood = -11446.916
Iteration 4:   log likelihood = -11445.993
Iteration 5:   log likelihood = -11445.969
Iteration 6:   log likelihood = -11445.968
Refining estimates:
Iteration 0:   log likelihood = -11445.968

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(7)       =     2226.98
Log likelihood  =   -11445.968                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9606994   .0798714    -0.48   0.630     .8162433    1.130721
      1.male |    1.24025   .0684839     3.90   0.000     1.113033    1.382009
        age1 |   1.068388   .0216929     3.26   0.001     1.026706    1.111763
        age2 |    1.02085   .0305157     0.69   0.490     .9627584    1.082446
        age3 |   .9925573   .1135954    -0.07   0.948     .7931182    1.242148
  1.dmard_pc |   .6599811   .0394119    -6.96   0.000     .5870844    .7419293
1.oral_pr~ne |   2.019727   .1114864    12.74   0.000     1.812622    2.250494
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estimates save $Tempdir/multivar2_eth2, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar2_et
> h2.ster saved

. * DAG+ other adjustments (NSAIDs, heart disease, lung disease, kidney disease
> , liver disease, BMI, hypertension, cancer, stroke, dementia, and respiratory
>  disease excl asthma (OCS capturing ashtma))
. stcox i.exposure i.male age1 age2 age3 i.dmard_pc i.oral_prednisolone i.nsaid
> s i.chronic_cardiac_disease i.resp_excl_asthma i.egfr_cat_nomiss i.chronic_li
> ver_disease i.obese4cat i.hypertension i.cancer_ever i.neuro_conditions i.flu
> _vaccine i.imd i.diabcat i.smoke_nomiss, strata(stp population)  

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -12559.456
Iteration 1:   log likelihood = -11435.504
Iteration 2:   log likelihood = -11130.279
Iteration 3:   log likelihood = -11114.934
Iteration 4:   log likelihood = -11114.393
Iteration 5:   log likelihood =  -11114.39
Iteration 6:   log likelihood =  -11114.39
Refining estimates:
Iteration 0:   log likelihood =  -11114.39

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(29)      =     2890.13
Log likelihood  =    -11114.39                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9751697   .0812266    -0.30   0.763     .8282845    1.148103
      1.male |   1.037733   .0592224     0.65   0.516     .9279154    1.160547
        age1 |   1.064612   .0216841     3.07   0.002     1.022949    1.107972
        age2 |   1.007246   .0303146     0.24   0.810     .9495494    1.068449
        age3 |   1.053264    .121669     0.45   0.653     .8398652    1.320884
  1.dmard_pc |   .7524054   .0454056    -4.71   0.000     .6684735    .8468755
1.oral_pr~ne |   1.695416   .0970183     9.23   0.000     1.515539    1.896642
    1.nsaids |   .9113674     .09052    -0.93   0.350     .7501521     1.10723
1.~c_disease |   1.629018   .0921718     8.62   0.000     1.458021    1.820069
1.resp_exc~a |   1.523057    .091117     7.03   0.000     1.354543    1.712534
             |
egfr_cat_n~s |
      30-59  |   .9892665   .0621283    -0.17   0.864     .8746934    1.118847
        <30  |   2.277282   .2465158     7.60   0.000     1.841935    2.815525
             |
1.~r_disease |   2.094519   .3104132     4.99   0.000     1.566513    2.800493
             |
   obese4cat |
Obese I ..)  |   .6640987   .0539383    -5.04   0.000     .5663669    .7786951
Obese II..)  |   .9034811   .1026234    -0.89   0.372     .7231592    1.128767
Obese II..)  |   .9394135   .1622847    -0.36   0.718     .6695929    1.317962
             |
1.hyperten~n |   1.021277   .0606573     0.35   0.723     .9090494    1.147359
1.cancer_e~r |   2.186056    .125723    13.60   0.000     1.953024    2.446894
1.neuro_co~s |   1.692363   .1100067     8.09   0.000     1.489923    1.922309
1.flu_vacc~e |    .764728   .0480265    -4.27   0.000     .6761605    .8648967
             |
         imd |
          2  |   1.191547   .1052975     1.98   0.047     1.002052    1.416877
          3  |   1.317759   .1155427     3.15   0.002      1.10969    1.564841
          4  |   1.230565   .1103814     2.31   0.021     1.032172    1.467091
5 most de..  |   1.490162   .1323685     4.49   0.000     1.252053    1.773553
             |
     diabcat |
Controlle..  |   1.154648   .0803494     2.07   0.039     1.007434    1.323375
Uncontrol..  |   1.521746   .1478263     4.32   0.000     1.257923    1.840899
Diabetes,..  |   1.932746   .2633962     4.84   0.000     1.479695    2.524511
             |
smoke_nomiss |
     Former  |    1.16063   .0719766     2.40   0.016     1.027795    1.310634
    Current  |   1.768955   .1627932     6.20   0.000     1.477007     2.11861
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estimates save $Tempdir/multivar3_eth2, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar3_et
> h2.ster saved

. *****************************************************************************
> *****************************************************************************
> ******************************
. *****************************************************************************
> *****************************************************************************
> ******************************
. 
. 
. /* Main Model (additionally adjusted for ethnicity) =========================
> =*/
. /* Univariable model */ 
. stcox i.exposure 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17762.887
Iteration 1:   log likelihood = -17750.161
Iteration 2:   log likelihood = -17749.966
Iteration 3:   log likelihood = -17749.966
Refining estimates:
Iteration 0:   log likelihood = -17749.966

Cox regression -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(1)       =       25.84
Log likelihood  =   -17749.966                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |    .673865   .0550448    -4.83   0.000     .5741724    .7908671
------------------------------------------------------------------------------

. estimates save $Tempdir/univar_eth3, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/univar_eth3.
> ster saved

. /* Multivariable models */ 
. * Age and Sex 
. * Age fit as spline 
. stcox i.exposure i.male age1 age2 age3 

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -17762.887
Iteration 1:   log likelihood = -16894.593
Iteration 2:   log likelihood = -16720.131
Iteration 3:   log likelihood = -16712.006
Iteration 4:   log likelihood =  -16711.09
Iteration 5:   log likelihood = -16711.066
Iteration 6:   log likelihood = -16711.066
Refining estimates:
Iteration 0:   log likelihood = -16711.066

Cox regression -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(5)       =     2103.64
Log likelihood  =   -16711.066                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9577366   .0788196    -0.52   0.600     .8150685    1.125377
      1.male |   1.237918   .0680573     3.88   0.000     1.111463    1.378759
        age1 |   1.067263   .0216972     3.20   0.001     1.025573    1.110647
        age2 |   1.027404   .0307221     0.90   0.366     .9689204    1.089418
        age3 |   .9711166   .1109946    -0.26   0.798      .776216    1.214955
------------------------------------------------------------------------------

. estimates save $Tempdir/multivar1_eth3, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar1_et
> h3.ster saved

. * DAG adjusted (age, sex, geographic region, other immunosuppressives (will i
> nclude biologics when we have them))  
. stcox i.exposure i.male age1 age2 age3 i.ethnicity i.dmard_pc i.oral_predniso
> lone, strata(stp population)                               

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -12559.456
Iteration 1:   log likelihood = -11619.653
Iteration 2:   log likelihood = -11451.996
Iteration 3:   log likelihood = -11443.203
Iteration 4:   log likelihood = -11442.283
Iteration 5:   log likelihood = -11442.259
Iteration 6:   log likelihood = -11442.259
Refining estimates:
Iteration 0:   log likelihood = -11442.259

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(11)      =     2234.39
Log likelihood  =   -11442.259                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9636911   .0801394    -0.44   0.657     .8187531    1.134286
      1.male |    1.23996   .0684848     3.89   0.000     1.112742    1.381722
        age1 |   1.067328   .0216468     3.21   0.001     1.025733     1.11061
        age2 |   1.020783   .0304737     0.69   0.491     .9627695    1.082292
        age3 |   .9945505   .1136878    -0.05   0.962     .7949236    1.244309
             |
   ethnicity |
South Asian  |   .6794653   .1117533    -2.35   0.019       .49223    .9379215
      Black  |   .7078579    .200737    -1.22   0.223      .406031    1.234051
      Mixed  |   .9914241   .4077896    -0.02   0.983      .442737    2.220103
      Other  |   .8956506   .3203187    -0.31   0.758     .4443412    1.805347
             |
  1.dmard_pc |   .6578372   .0392909    -7.01   0.000      .585165    .7395346
1.oral_pr~ne |   2.019192   .1114855    12.73   0.000     1.812092    2.249961
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estimates save $Tempdir/multivar2_eth3, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar2_et
> h3.ster saved

. * DAG+ other adjustments (NSAIDs, heart disease, lung disease, kidney disease
> , liver disease, BMI, hypertension, cancer, stroke, dementia, and respiratory
>  disease excl asthma (OCS capturing ashtma))
. stcox i.exposure i.male age1 age2 age3 i.ethnicity i.dmard_pc i.oral_predniso
> lone i.nsaids i.chronic_cardiac_disease i.resp_excl_asthma i.egfr_cat_nomiss 
> i.chronic_liver_disease i.obese4cat i.hypertension i.cancer_ever i.neuro_cond
> itions i.flu_vaccine i.imd i.diabcat i.smoke_nomiss, strata(stp population)  
>     

         failure _d:  onsnoncoviddeath
   analysis time _t:  (stime_onsnoncoviddeath-origin)
             origin:  time enter_date
  enter on or after:  time enter_date
                 id:  patient_id

Iteration 0:   log likelihood = -12559.456
Iteration 1:   log likelihood = -11434.087
Iteration 2:   log likelihood =  -11126.57
Iteration 3:   log likelihood = -11111.213
Iteration 4:   log likelihood = -11110.674
Iteration 5:   log likelihood =  -11110.67
Iteration 6:   log likelihood =  -11110.67
Refining estimates:
Iteration 0:   log likelihood =  -11110.67

Stratified Cox regr. -- Breslow method for ties

No. of subjects =      149,309                  Number of obs    =     149,309
No. of failures =        1,493
Time at risk    =     19665328
                                                LR chi2(33)      =     2897.57
Log likelihood  =    -11110.67                  Prob > chi2      =      0.0000

------------------------------------------------------------------------------
          _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    exposure |
        HCQ  |   .9801126   .0816692    -0.24   0.809     .8324315    1.153994
      1.male |   1.043695   .0595725     0.75   0.454     .9332296    1.167237
        age1 |    1.06353   .0216188     3.03   0.002      1.02199    1.106757
        age2 |   1.007394     .03026     0.25   0.806     .9497978    1.068483
        age3 |   1.053607   .1215072     0.45   0.651     .8404533    1.320819
             |
   ethnicity |
South Asian  |   .6848057   .1146338    -2.26   0.024     .4932642    .9507256
      Black  |   .6687925   .1901526    -1.41   0.157      .383068    1.167635
      Mixed  |    .959677    .395768    -0.10   0.921     .4276535    2.153566
      Other  |   .8588019   .3076478    -0.42   0.671     .4255669    1.733078
             |
  1.dmard_pc |   .7510784    .045328    -4.74   0.000     .6672903    .8453873
1.oral_pr~ne |   1.696003   .0970882     9.23   0.000     1.516001    1.897378
    1.nsaids |   .9107341   .0904638    -0.94   0.347     .7496201    1.106476
1.~c_disease |   1.631575     .09234     8.65   0.000     1.460269    1.822978
1.resp_exc~a |   1.517811   .0908902     6.97   0.000     1.349726    1.706828
             |
egfr_cat_n~s |
      30-59  |   .9881777   .0620852    -0.19   0.850     .8736868    1.117672
        <30  |   2.277047   .2467142     7.59   0.000      1.84139    2.815777
             |
1.~r_disease |   2.086924   .3092829     4.96   0.000      1.56084    2.790327
             |
   obese4cat |
Obese I ..)  |   .6615854   .0537632    -5.08   0.000     .5641748    .7758149
Obese II..)  |   .8952901   .1017766    -0.97   0.331     .7164719    1.118738
Obese II..)  |   .9277949   .1604234    -0.43   0.665     .6611077    1.302062
             |
1.hyperten~n |     1.0256   .0609377     0.43   0.671     .9128567    1.152268
1.cancer_e~r |   2.173661   .1251037    13.49   0.000     1.941787    2.433225
1.neuro_co~s |   1.692158   .1100026     8.09   0.000     1.489727    1.922097
1.flu_vacc~e |   .7605932   .0478021    -4.35   0.000     .6724433    .8602985
             |
         imd |
          2  |   1.191375   .1052872     1.98   0.048     1.001899    1.416684
          3  |   1.324443   .1161471     3.20   0.001     1.115288    1.572822
          4  |   1.245307   .1118295     2.44   0.015      1.04433    1.484961
5 most de..  |   1.518245   .1352205     4.69   0.000      1.27506    1.807811
             |
     diabcat |
Controlle..  |   1.174613   .0819981     2.31   0.021     1.024409     1.34684
Uncontrol..  |   1.557457   .1518679     4.54   0.000     1.286516    1.885458
Diabetes,..  |   1.962911   .2676844     4.95   0.000     1.502524    2.564366
             |
smoke_nomiss |
     Former  |   1.133398   .0708517     2.00   0.045     1.002701     1.28113
    Current  |   1.710353   .1588155     5.78   0.000     1.425762     2.05175
------------------------------------------------------------------------------
                                                  Stratified by stp population

. estimates save $Tempdir/multivar3_eth3, replace 
file E:\analyses\hydroxychloroquine-research/output/sens1/tempdata/multivar3_et
> h3.ster saved

. *****************************************************************************
> *****************************************************************************
> ******************************
. *****************************************************************************
> *****************************************************************************
> ******************************
. 
. 
. 
. /* Print table===============================================================
> =*/ 
. *  Print the results for the main model 
. 
. cap file close tablecontent

. file open tablecontent using $Tabfigdir/table6.txt, write text replace

. 
. * Column headings 
. file write tablecontent ("Table 6: Ethnicity adjustments") _n

. file write tablecontent _tab ("N") _tab ("Univariable") _tab _tab ("Age/Sex A
> djusted") _tab _tab ///
>                                                 ("DAG Adjusted") _tab _tab ("
> Fully Adjusted") _tab _tab  _n

. file write tablecontent _tab _tab ("HR") _tab ("95% CI") _tab ("HR") _tab ///
>                                                 ("95% CI") _tab ("HR") _tab (
> "95% CI") _tab ("HR") _tab ("95% CI") _n

.         
. /* Main Model (without adjusting for ethnicity) ======*/
. file write tablecontent ("Main Analysis, without adjusting for ethnicity") _n
>                                    

. 
. * Row headings 
. local lab0: label exposure 0

. local lab1: label exposure 1

.  
. /* Counts */
. * Refresh Stata dataset (bring back those with missing ethnicity for row tota
> ls)
. use $Tempdir\analysis_dataset_STSET_$outcome, clear

.  
. * First row, exposure = 0 (reference)
. 
.         cou if exposure == 0 
  164,068

.         local rowdenom = r(N)

.         cou if exposure == 0 & $outcome == 1
  1,769

.         local pct = 100*(r(N)/`rowdenom') 

.         
.         file write tablecontent ("`lab0'") _tab

.         file write tablecontent (r(N)) (" (") %3.1f (`pct') (")") _tab

.         file write tablecontent ("1.00 (ref)") _tab _tab ("1.00 (ref)") _tab 
> _tab ("1.00 (ref)")  _tab _tab ("1.00 (ref)") _n

.         
. * Second row, exposure = 1 (comparator)
. 
. file write tablecontent ("`lab1'") _tab  

. 
.         cou if exposure == 1 
  30,569

.         local rowdenom = r(N)

.         cou if exposure == 1 & $outcome == 1
  234

.         local pct = 100*(r(N)/`rowdenom') 

.         file write tablecontent (r(N)) (" (") %3.1f (`pct') (")") _tab

. 
. /* Main Model */ 
. estimates use $Tempdir/univar_eth1 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .7005092   .0487285    -5.12   0.000     .6112276    .8028322
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar1_eth1 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9994149   .0700884    -0.01   0.993     .8710669    1.146674
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar2_eth1 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.000759   .0709099     0.01   0.991     .8709972    1.149853
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar3_eth1 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   1.013382   .0719347     0.19   0.851     .8817614    1.164651
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _n 

. 
. file write tablecontent _n _n

. 
. 
. 
. /* Main Model (same adjustments, removing those with missing ethnicity) =====
> =*/
. file write tablecontent ("Main Analysis, dropping individuals with missing et
> hnicity") _n                                       

. 
. * Row headings 
. local lab0: label exposure 0

. local lab1: label exposure 1

.  
. /* Counts */
. /* Restrict population=======================================================
> =*/ 
. drop if ethnicity == .u
(45,328 observations deleted)

.  
. * First row, exposure = 0 (reference)
. 
.         cou if exposure == 0 
  125,807

.         local rowdenom = r(N)

.         cou if exposure == 0 & $outcome == 1
  1,324

.         local pct = 100*(r(N)/`rowdenom') 

.         
.         file write tablecontent ("`lab0'") _tab

.         file write tablecontent (r(N)) (" (") %3.1f (`pct') (")") _tab

.         file write tablecontent ("1.00 (ref)") _tab _tab ("1.00 (ref)") _tab 
> _tab ("1.00 (ref)")  _tab _tab ("1.00 (ref)") _n

.         
. * Second row, exposure = 1 (comparator)
. 
. file write tablecontent ("`lab1'") _tab  

. 
.         cou if exposure == 1 
  23,502

.         local rowdenom = r(N)

.         cou if exposure == 1 & $outcome == 1
  169

.         local pct = 100*(r(N)/`rowdenom') 

.         file write tablecontent (r(N)) (" (") %3.1f (`pct') (")") _tab

. 
. /* Main Model */ 
. estimates use $Tempdir/univar_eth2 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    .673865   .0550448    -4.83   0.000     .5741724    .7908671
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar1_eth2 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9577366   .0788196    -0.52   0.600     .8150685    1.125377
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar2_eth2 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9606994   .0798714    -0.48   0.630     .8162433    1.130721
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar3_eth2 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9751697   .0812266    -0.30   0.763     .8282845    1.148103
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _n 

. 
. file write tablecontent _n _n

. 
. 
. /* Main Model (additionally adjusted for ethnicity) =========================
> =*/
. file write tablecontent ("Main Analysis, adjusting for ethnicity") _n        
>                            

. 
. * Row headings 
. local lab0: label exposure 0

. local lab1: label exposure 1

.  
. /* Counts */
.  
. * First row, exposure = 0 (reference)
. 
.         cou if exposure == 0 
  125,807

.         local rowdenom = r(N)

.         cou if exposure == 0 & $outcome == 1
  1,324

.         local pct = 100*(r(N)/`rowdenom') 

.         
.         file write tablecontent ("`lab0'") _tab

.         file write tablecontent (r(N)) (" (") %3.1f (`pct') (")") _tab

.         file write tablecontent ("1.00 (ref)") _tab _tab ("1.00 (ref)") _tab 
> _tab ("1.00 (ref)")  _tab _tab ("1.00 (ref)") _n

.         
. * Second row, exposure = 1 (comparator)
. 
. file write tablecontent ("`lab1'") _tab  

. 
.         cou if exposure == 1 
  23,502

.         local rowdenom = r(N)

.         cou if exposure == 1 & $outcome == 1
  169

.         local pct = 100*(r(N)/`rowdenom') 

.         file write tablecontent (r(N)) (" (") %3.1f (`pct') (")") _tab

. 
. /* Main Model */ 
. estimates use $Tempdir/univar_eth3 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |    .673865   .0550448    -4.83   0.000     .5741724    .7908671
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar1_eth3 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9577366   .0788196    -0.52   0.600     .8150685    1.125377
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar2_eth3 

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9636911   .0801394    -0.44   0.657     .8187531    1.134286
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _tab 

. 
. estimates use $Tempdir/multivar3_eth3

. lincom 1.exposure, eform

 ( 1)  1.exposure = 0

------------------------------------------------------------------------------
          _t |     exp(b)   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         (1) |   .9801126   .0816692    -0.24   0.809     .8324315    1.153994
------------------------------------------------------------------------------

. file write tablecontent %4.2f (r(estimate)) _tab ("(") %4.2f (r(lb)) ("-") %4
> .2f (r(ub)) (")") _n 

. 
. file write tablecontent _n

. 
. file close tablecontent

. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  E:\analyses\hydroxychloroquine-research/output/sens1/log\10_an_mod
> els_ethnicity.log
  log type:  text
 closed on:   6 Oct 2020, 13:25:17
-------------------------------------------------------------------------------
